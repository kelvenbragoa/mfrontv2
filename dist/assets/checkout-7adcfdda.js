import{_ as Q}from"./mpesa-18b7c6e9.js";import{u as X,r as c,a as Y,G as U,h as $,o as Z,b,c as n,d,e,t as o,g as s,F as ee,D as te,f as u,s as g,v as x,l as C,k as se,w as D}from"./index-da4e25fd.js";import{b as F,s as ae}from"./APIConstant-3b96cd31.js";import{h as m}from"./moment-a9aaa855.js";import"./vue-numeric.min-7ed4db12.js";import{u as oe}from"./vee-validate.esm-f9eb7de3.js";import{c as le,a as E}from"./index.esm-8e4dfa6c.js";const ne={key:0,id:"features",class:"py-4 px-4 lg:px-8 mt-5 mx-0 lg:mx-8"},ie={class:"grid justify-content-left"},re={class:"col-12 text-left mt-8 mb-4"},de={class:"text-900 font-normal mb-2"},ue={class:"text-600 text-2xl"},ce={class:"col-12 md:col-12 lg:col-12 p-0 lg:pr-5 lg:pb-5 mt-4 lg:mt-0"},me={style:{padding:"2px","border-radius":"10px",background:"linear-gradient(90deg, rgba(253, 228, 165, 0.2), rgba(187, 199, 205, 0.2)), linear-gradient(180deg, rgba(253, 228, 165, 0.2), rgba(187, 199, 205, 0.2))"}},_e={class:"p-3 surface-card h-full",style:{"border-radius":"8px"}},pe=e("h2",{class:"text-900 font-normal mb-2"},"Pagamentos",-1),ve={class:"grid grid-nogutter"},he={class:"md:w-10rem relative"},fe=["src","alt"],be={class:"flex flex-column md:flex-row justify-content-between md:align-items-center flex-1 gap-4"},ge={class:"flex flex-row md:flex-column justify-content-between align-items-start gap-2"},xe={class:"text-lg font-medium text-900 mt-2"},ye={class:"text-lg font-medium text-900 mt-2"},ke={class:"text-lg font-medium text-900 mt-2"},Ne={key:0,class:"flex flex-column md:align-items-end gap-5"},Se={class:"text-xl font-semibold text-900 text-red"},Ve={key:1,class:"flex flex-column md:align-items-end gap-5"},Te={class:"text-xl font-semibold text-900"},we={class:"flex flex-row-reverse md:flex-row gap-2"},Be=e("span",{class:"pi pi-plus"},null,-1),Le=e("span",{class:"pi pi-minus"},null,-1),Me=e("hr",null,null,-1),Ce={key:0},Ee=e("h2",{class:"text-900 font-normal mb-2"},"Resumo da Encomenda",-1),Pe={class:"text-900 font-normal mb-2"},qe={class:"text-900 font-normal mb-2"},Oe={class:"card p-fluid"},Ue=e("h5",null,"Detalhes do Cliente",-1),$e={class:"field"},De=e("label",{for:"customerName"},"Nome",-1),Fe={id:"city_id-help",class:"p-error"},Ie={class:"field"},He=e("label",{for:"customerEmail"},"Email ( O seu bilhete será encaminhado para este email)",-1),Re={id:"city_id-help",class:"p-error"},Ae={class:"field"},We=e("label",{for:"customerMobile"},"Telemóvel ( WhatsApp - O seu bilhete será encaminhado para este número)",-1),je={id:"city_id-help",class:"p-error"},Ke={class:"card p-fluid"},ze=e("h5",null,"Informações do Pagamento",-1),Je={key:0},Ge=e("img",{src:Q,alt:"Logo",height:"100",class:"mr-2"},null,-1),Qe={class:"field"},Xe=e("label",{for:"paymentNumber"},"Número de MPESA",-1),Ye={id:"city_id-help",class:"p-error"},Ze={class:"field"},et={key:1,class:"field"},tt=e("label",null,"Nota: Recomendamos que registre-se na plataforma e faça a compra do seu bilhete, para manter históricos dos seus bilhetes e recuperar a qualquer momento.",-1),st=[tt],at={class:"field"},ot={key:1},lt=e("h2",{class:"text-900 font-normal mb-2"},"Pagamentos",-1),nt=e("h5",{class:"text-900 font-normal mb-2"},"Nenhum Bilhete Selecionado!",-1),it=[lt,nt],rt={key:1,class:"text-center"},dt=e("p",null,"Por Favor Aguarde...",-1),gt={__name:"checkout",setup(ut){const y=X(),T=c(!0),i=c(!1);c(!1);const p=c(),v=c(),w=Y();c([]),c([]),c(0);const r=c([]),I=le({customerName:E().required().trim().label("Nome"),customerEmail:E().required().trim().label("Email"),customerMobile:E().required().trim().label("Telefone")}),{defineField:h,handleSubmit:H,resetForm:ct,errors:_,setErrors:R}=oe({validationSchema:I}),[k]=h("customerName"),[N]=h("customerEmail"),[S]=h("customerMobile"),[B]=h("paymentNumber"),[V]=h("user_id"),A=l=>{switch(l){case"INSTOCK":return"success";case"LOWSTOCK":return"warning";case"OUTOFSTOCK":return"danger";default:return null}};function W(){y&&y.back()}const P=U(()=>v.value.reduce((l,a)=>l+a.quantity,0)),L=U(()=>v.value.reduce((l,a)=>l+a.quantity*a.price,0)),M=H(l=>{l.tickets=v.value,l.amount=L.value,l.tickets,i.value=!0,$.post(`${F}/checkout`,l,{headers:{"Content-Type":"multipart/form-data"}}).then(a=>{localStorage.setItem("order",JSON.stringify(a.data.order)),y.push({path:"/encomenda"}),w.add({severity:"success",summary:"Successo",detail:"A sua compra foi efetuada com sucesso",life:3e3})}).catch(a=>{i.value=!1,w.add({severity:"error",summary:`${a.response.data.message}`,detail:"Detalhe da Mensagem",life:3e3}),a.response.data.errors&&R(a.response.data.errors)}).finally(()=>{i.value=!1})}),j=()=>{$.get(`${F}/checkout/${y.currentRoute.value.params.id}`).then(l=>{p.value=l.data.events,v.value=l.data.tickets,T.value=!1}).catch(l=>{T.value=!1,w.add({severity:"error",summary:`${l}`,detail:"Message Detail",life:3e3}),W()})};return Z(()=>{r.value=JSON.parse(localStorage.getItem("user")),r.value&&(k.value=r.value.name,N.value=r.value.email,S.value=r.value.mobile,V.value=r.value.id),j()}),(l,a)=>{const q=b("Tag"),K=b("InputNumber"),f=b("InputText"),z=b("Button"),O=b("ProgressSpinner");return T.value?(n(),d("div",rt,[u(O,{style:{width:"50px",height:"50px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"}),dt])):(n(),d("div",ne,[e("div",ie,[e("div",re,[e("h2",de,o(p.value.name),1),e("span",ue,o(s(m)(p.value.start_date).format("LL"))+", "+o(p.value.address)+", "+o(p.value.province.name),1)]),e("div",ce,[e("div",me,[e("div",_e,[pe,e("div",ve,[(n(!0),d(ee,null,te(v.value,(t,J)=>(n(),d("div",{key:t.id,class:"col-12"},[e("div",{class:x(["flex flex-column sm:flex-row sm:align-items-center p-4 gap-3",{"border-top-1 surface-border":J!==0}])},[e("div",he,[e("img",{class:"block xl:block border-round mx-auto border-round w-full",src:s(ae)+p.value.image,alt:t.name},null,8,fe),u(q,{value:t.inventoryStatus,severity:A(t),class:"absolute",style:{left:"4px",top:"4px"}},null,8,["value","severity"])]),e("div",be,[e("div",ge,[e("div",null,[e("div",xe,o(t.name),1),e("div",ye,"Inicio: "+o(s(m)(t.start_date).format("LL"))+" "+o(s(m)(t.start_time,"HH:mm:ss").format("HH:mm")),1),e("div",ke,"Fim: "+o(s(m)(t.end_date).format("LL"))+" "+o(s(m)(t.end_time,"HH:mm:ss").format("HH:mm")),1)])]),s(m)().isAfter(s(m)(`${t.end_date} ${t.end_time}`))||t.max_qtd<=0||s(m)().isSameOrBefore(s(m)(`${t.start_date} ${t.start_time})`))?(n(),d("div",Ne,[e("span",Se,[u(q,{value:"Bilhete Indisponível",severity:"danger"})])])):(n(),d("div",Ve,[e("span",Te,o(t.price)+" MT",1),e("div",we,[u(K,{modelValue:t.quantity,"onUpdate:modelValue":G=>t.quantity=G,showButtons:"",buttonLayout:"horizontal",min:0,max:5,disabled:i.value},{incrementbuttonicon:D(()=>[Be]),decrementbuttonicon:D(()=>[Le]),_:2},1032,["modelValue","onUpdate:modelValue","disabled"])])]))])],2)]))),128))]),Me,P.value>0?(n(),d("div",Ce,[Ee,e("h5",Pe,"Total de Bilhetes: "+o(P.value),1),e("h5",qe,"Preço Total: "+o(L.value.toFixed(2))+" MT",1),e("form",{onSubmit:a[5]||(a[5]=(...t)=>s(M)&&s(M)(...t))},[e("div",Oe,[Ue,e("div",$e,[De,u(f,{id:"customerName",modelValue:s(k),"onUpdate:modelValue":a[0]||(a[0]=t=>g(k)?k.value=t:null),type:"text",class:x({"p-invalid":s(_).customerName}),disabled:i.value||r.value},null,8,["modelValue","class","disabled"]),e("small",Fe,o(s(_).customerName),1)]),e("div",Ie,[He,u(f,{id:"customerEmail",modelValue:s(N),"onUpdate:modelValue":a[1]||(a[1]=t=>g(N)?N.value=t:null),type:"email",class:x({"p-invalid":s(_).customerEmail}),disabled:i.value||r.value},null,8,["modelValue","class","disabled"]),e("small",Re,o(s(_).customerEmail),1)]),e("div",Ae,[We,u(f,{id:"customerMobile",modelValue:s(S),"onUpdate:modelValue":a[2]||(a[2]=t=>g(S)?S.value=t:null),type:"number",class:x({"p-invalid":s(_).customerMobile}),disabled:i.value||r.value},null,8,["modelValue","class","disabled"]),e("small",je,o(s(_).customerMobile),1)])]),e("div",Ke,[ze,p.value.type_event_id==1?(n(),d("div",Je,[Ge,e("div",Qe,[Xe,u(f,{id:"paymentNumber",modelValue:s(B),"onUpdate:modelValue":a[3]||(a[3]=t=>g(B)?B.value=t:null),type:"text",class:x({"p-invalid":s(_).paymentNumber}),disabled:i.value},null,8,["modelValue","class","disabled"]),u(f,{id:"user_id",modelValue:s(V),"onUpdate:modelValue":a[4]||(a[4]=t=>g(V)?V.value=t:null),type:"hidden"},null,8,["modelValue"]),e("small",Ye,o(s(_).paymentNumber),1)])])):C("",!0),e("div",Ze,[e("label",null,"Valor Total a Pagar: "+o(L.value.toFixed(2))+" MT",1)]),r.value?C("",!0):(n(),d("div",et,st)),e("div",at,[u(z,{label:"Submeter",class:"mr-2 mb-2",onClick:s(M),disabled:i.value},null,8,["onClick","disabled"]),i.value?(n(),se(O,{key:0,style:{width:"35px",height:"35px"},strokeWidth:"8",fill:"var(--surface-ground)",animationDuration:".5s","aria-label":"Custom ProgressSpinner"})):C("",!0)])])],32)])):(n(),d("div",ot,it))])])])])]))}}};export{gt as default};
